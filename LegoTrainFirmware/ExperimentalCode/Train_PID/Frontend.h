#ifndef FRONTEND_H
#define FRONTEND_H

#include <Arduino.h>

// Auto-generated HTML pages for Arduino web server
// Generated by html_to_progmem.py with advanced compression

const char indexPage[] PROGMEM = R"rawliteral(
<!DOCTYPE html><html lang=en ><head><meta charset=UTF-8 ><meta name=viewport content="width=device-width, initial-scale=1.0"><title>Remote Train Control</title><style>:root{--primary-color:#cbcdd8a2;--secondary-color:#ffae00;--secondary-color-shade1:#90ee38;--secondary-color-shade2:#f39e2e;--secondary-color-shade3:#880d0d;--deactivated-color:#c9b68e}body{display:flex;justify-content:center;align-items:center;height:100vh;margin:0;font-family:Arial,sans-serif;background-color:var(--primary-color)}.container{display:flex;flex-direction:column;width:100%;height:100%}.top-half{display:flex;flex-direction:column;width:100%;height:50%}.buttons{display:flex;justify-content:space-around;align-items:center;height:30%}.mode-button{width:20%;height:80%;background-color:var(--secondary-color);color:#fff;border:none;border-radius:5px;font-size:1.2em;cursor:pointer}.bars{display:flex;justify-content:space-around;align-items:center;height:70%}.bar{width:20%;height:80%;background-color:#f0f0f0;border:2px solid #ccc;border-radius:10px;position:relative}.setpoint-value{width:100%;height:20%;background-color:var(--secondary-color-shade1);position:absolute;bottom:0;border-radius:10px 10px 0 0}.input-value{width:100%;height:20%;background-color:var(--secondary-color-shade2);position:absolute;bottom:0;border-radius:10px 10px 0 0}.output-value{width:100%;height:20%;background-color:var(--secondary-color-shade3);position:absolute;bottom:0;border-radius:10px 10px 0 0}.bottom-left-quarter{display:flex;justify-content:center;align-items:center;width:50%;height:50%;position:absolute;bottom:0;left:0}.bottom-right-quarter{display:flex;justify-content:center;align-items:center;flex-direction:column;width:50%;height:50%;position:absolute;bottom:0;right:0}.bottom-right-button{width:80%;height:20%;background-color:var(--secondary-color);color:#fff;border:none;border-radius:5px;font-size:1.2em;cursor:pointer;margin:5px 0}.joystick-container{width:100px;height:300px;background-color:#f0f0f0;border:2px solid #ccc;border-radius:10px;position:relative}.joystick-container::before{content:'';position:absolute;top:50%;left:10%;right:10%;height:2px;background-color:#999;transform:translateY(-1px)}.joystick-container::after{content:'';position:absolute;top:calc(50% - 15px);left:10%;right:10%;height:30px;background-color:rgba(153,153,153,0.2);border-radius:3px}.joystick{width:80px;height:80px;background-color:var(--secondary-color);border-radius:50%;position:absolute;left:50%;transform:translate(-50%);cursor:pointer}.toggle-button{background-color:var(--secondary-color);color:white;border:none;border-radius:5px;padding:8px 16px;margin-left:10px;cursor:pointer;font-size:0.9em;font-weight:bold;height:80%}.toggle-button:hover{background-color:var(--secondary-color-shade1)}#graphCanvas{width:100%;height:100%;background-color:#f8f8f8;border:2px solid #ccc;border-radius:10px;display:none}</style></head><body><div class=container ><div class=top-half ><div class=buttons ><button class=mode-button id=btn_mode1 >Manual</button><button class=mode-button id=btn_mode2 >Target Output</button><button class=mode-button id=btn_mode3 >Target Speed</button><button class=mode-button id=btn_mode4 >Full Auto</button><button class=toggle-button id=displayToggle >Show Graph</button></div><div class=bars id=barsContainer ><div class=bar ><div class=setpoint-value id=bar_setpoint ></div></div><div class=bar ><div class=input-value id=bar_input ></div></div><div class=bar ><div class=output-value id=bar_output ></div></div></div><canvas id=graphCanvas width=800 height=200 ></canvas><div style="display: flex; justify-content: space-around; margin-top: 5px;" id=barLabels ><div style="text-align: center; width: 20%; font-size: 0.9em; font-weight: bold; color: #333;">
Setpoint
</div><div style="text-align: center; width: 20%; font-size: 0.9em; font-weight: bold; color: #333;">
Input
</div><div style="text-align: center; width: 20%; font-size: 0.9em; font-weight: bold; color: #333;">
Output
</div></div></div><div class=bottom-left-quarter ><div class=joystick-container ><div class=joystick id=joystick ></div></div><div style="text-align: center; margin-top: 10px; font-weight: bold; font-size: 1.1em;"><span style="color: #333;">Value: </span><span id=joystick-value style="color: #ffae00; font-family: monospace;">0</span></div></div><div class=bottom-right-quarter ><p style="color: #333; text-align: center; margin-bottom: 20px;">
Joystick: Up=Forward (+100), Down=Backward (-100)<br>
Range: -100 to +100 with deadband
</p><button class=bottom-right-button style="background-color: red;" id=stop_btn >STOP</button></div></div>
<script>var modeButtons = ["btn_mode1","btn_mode2","btn_mode3","btn_mode4"];
var selectedMode = 0;
var modeCallback = null;

var currentSetpoint = 0;

var dataHistory = {
setpoint: [],
input: [],
output: [],
maxLength: 100
};
var showGraph = false;
var canvas, ctx;

function addDataPoint(setpoint, input, output) {
dataHistory.setpoint.push(setpoint);
dataHistory.input.push(input);
dataHistory.output.push(output);

if(dataHistory.setpoint.length > dataHistory.maxLength) {
dataHistory.setpoint.shift();
dataHistory.input.shift();
dataHistory.output.shift();
}
}

function drawGraph() {
if(!canvas || !ctx || !showGraph) return;

const width = canvas.width;
const height = canvas.height;
const padding = 40;
const graphWidth = width - 2 * padding;
const graphHeight = height - 2 * padding;

ctx.fillStyle = '#f8f8f8';
ctx.fillRect(0, 0, width, height);

ctx.strokeStyle = '#ddd';
ctx.lineWidth = 1;
ctx.beginPath();

for(let i = 0; i <= 10; i++) {
const y = padding + (i * graphHeight / 10);
ctx.moveTo(padding, y);
ctx.lineTo(width - padding, y);
}

for(let i = 0; i <= 10; i++) {
const x = padding + (i * graphWidth / 10);
ctx.moveTo(x, padding);
ctx.lineTo(x, height - padding);
}
ctx.stroke();

ctx.strokeStyle = '#333';
ctx.lineWidth = 2;
ctx.beginPath();
ctx.moveTo(padding, padding);
ctx.lineTo(padding, height - padding);
ctx.lineTo(width - padding, height - padding);
ctx.stroke();

const allData = [...dataHistory.setpoint, ...dataHistory.input, ...dataHistory.output];
const minVal = Math.min(...allData, -100);
const maxVal = Math.max(...allData, 100);
const range = maxVal - minVal;

ctx.fillStyle = '#333';
ctx.font = '12px Arial';
ctx.textAlign = 'right';
ctx.textBaseline = 'middle';

for(let i = 0; i <= 10; i++) {
const y = padding + (i * graphHeight / 10);
const value = maxVal - (i / 10) * range;
ctx.fillText(Math.round(value), padding - 8, y);
}

ctx.textAlign = 'left';
ctx.textBaseline = 'alphabetic';

if(dataHistory.setpoint.length > 1) {
drawLine(dataHistory.setpoint, '#90ee38', 'Setpoint');
drawLine(dataHistory.input, '#f39e2e', 'Input');
drawLine(dataHistory.output, '#880d0d', 'Output');
}

drawLegend();
}

function drawLine(data, color, label) {
if(data.length < 2) return;

const width = canvas.width;
const height = canvas.height;
const padding = 40;
const graphWidth = width - 2 * padding;
const graphHeight = height - 2 * padding;

const allData = [...dataHistory.setpoint, ...dataHistory.input, ...dataHistory.output];
const minVal = Math.min(...allData, -100);
const maxVal = Math.max(...allData, 100);
const range = maxVal - minVal;

ctx.strokeStyle = color;
ctx.lineWidth = 2;
ctx.beginPath();

for(let i = 0; i < data.length; i++) {
const x = padding + (i / (dataHistory.maxLength - 1)) * graphWidth;
const y = height - padding - ((data[i] - minVal) / range) * graphHeight;

if(i === 0) {
ctx.moveTo(x, y);
} else {
ctx.lineTo(x, y);
}
}
ctx.stroke();
}

function drawLegend() {
const legendX = canvas.width - 150;
const legendY = 20;

ctx.font = '12px Arial';

ctx.fillStyle = '#90ee38';
ctx.fillRect(legendX, legendY, 15, 3);
ctx.fillStyle = '#333';
ctx.fillText('Setpoint', legendX + 20, legendY + 10);

ctx.fillStyle = '#f39e2e';
ctx.fillRect(legendX, legendY + 20, 15, 3);
ctx.fillStyle = '#333';
ctx.fillText('Input', legendX + 20, legendY + 30);

ctx.fillStyle = '#880d0d';
ctx.fillRect(legendX, legendY + 40, 15, 3);
ctx.fillStyle = '#333';
ctx.fillText('Output', legendX + 20, legendY + 50);
}

function toggleDisplay() {
showGraph = !showGraph;
const barsContainer = document.getElementById('barsContainer');
const barLabels = document.getElementById('barLabels');
const graphCanvas = document.getElementById('graphCanvas');
const toggleButton = document.getElementById('displayToggle');

if(showGraph) {
barsContainer.style.display = 'none';
barLabels.style.display = 'none';
graphCanvas.style.display = 'block';
toggleButton.textContent = 'Show Bars';

if(!canvas) {
canvas = graphCanvas;
ctx = canvas.getContext('2d');
}
drawGraph();
} else {
barsContainer.style.display = 'flex';
barLabels.style.display = 'flex';
graphCanvas.style.display = 'none';
toggleButton.textContent = 'Show Graph';
}
}

function initModeSelector(){
modeButtons.forEach(function(buttonId){
document.getElementById(buttonId).addEventListener("click", function(){
onModeButtonClicked(buttonId);
});
});

document.getElementById('displayToggle').addEventListener('click', toggleDisplay);

setModeSelection(0);
}

function onModeButtonClicked(buttonId){
selectedMode = modeButtons.indexOf(buttonId);
modeButtons.forEach(function(id){
if(modeCallback != null){
modeCallback(selectedMode);
}
if(id == buttonId){
document.getElementById(id).style = "background-color: var(--secondary-color)";
} else {
document.getElementById(id).style = "background-color: var(--deactivated-color)";
}
});
}

function getSelectedMode(){
return selectedMode;
}

function setModeSelection(mode){
onModeButtonClicked(modeButtons[mode]);
}

function setModeCallback(callback){
modeCallback = callback;
}

const joystick = document.getElementById("joystick");
const joystickContainer = document.querySelector(".joystick-container");
var stopCallback = null;

function resetJoystickPosition(){

const centerY = (joystickContainer.offsetHeight - joystick.offsetHeight) / 2;
joystick.style.top = `${centerY}px`;
}

function setStopCallback(callback){
stopCallback = callback;
}

function initJoystick(){
window.addEventListener('load', resetJoystickPosition);

document.getElementById("stop_btn").addEventListener("click", function(){
if(stopCallback != null){
stopCallback();
}
resetJoystickPosition();
});

function addTouchEvents(element) {
element.addEventListener('touchstart', (e) => {
e.preventDefault();

moveJoystick(e.touches[0]);

const handleTouchMove = (e) => {
moveJoystick(e.touches[0]);
};
document.addEventListener('touchmove', handleTouchMove);
document.addEventListener('touchend', () => {
document.removeEventListener('touchmove', handleTouchMove);
}, { once: true });
});
}

function addMouseEvents(element) {
element.addEventListener('mousedown', (e) => {

moveJoystick(e);

const handleMouseMove = (e) => {
moveJoystick(e);
};
document.addEventListener('mousemove', handleMouseMove);
document.addEventListener('mouseup', () => {
document.removeEventListener('mousemove', handleMouseMove);
}, { once: true });
});
}

addTouchEvents(joystick);
addTouchEvents(joystickContainer);
addMouseEvents(joystick);
addMouseEvents(joystickContainer);
}

function getJoystickValue(){
var value = getJoystickRawValue();

if(Math.abs(value) < 5) {
value = 0;
}

console.log("Joystick value: " + value);
return value;
}

function getJoystickRawValue(){
const containerRect = joystickContainer.getBoundingClientRect();
const joystickRect = joystick.getBoundingClientRect();
const containerCenter = containerRect.top + containerRect.height / 2;
const joystickCenter = joystickRect.top + joystickRect.height / 2;

const maxMovement = (containerRect.height - joystick.offsetHeight) / 2;
const distance = joystickCenter - containerCenter;

let percentage = distance / maxMovement - 0.02;

percentage = Math.max(-1, Math.min(1, percentage));

return Math.round(-percentage * 100);
}

function moveJoystick(e){
const containerRect = joystickContainer.getBoundingClientRect();
const maxY = containerRect.height - joystick.offsetHeight;
let newY = e.clientY - containerRect.top - joystick.offsetHeight / 2;
newY = Math.max(0, Math.min(maxY, newY));
joystick.style.top = `${newY}px`;
}

var controlData = {setpoint: 0, input: 0, output: 0};
const maxSpeed = 500;
let websocket;
const host = window.location.hostname;//"192.168.178.94"//

function onWebSocketMessage(event){
const data = JSON.parse(event.data);
console.log("WebSocket message received:", data);
if(data.hasOwnProperty('controlData')){
controlData = data.controlData;
updateDisplay(controlData);
}
}

function initWebSocket(){
websocket = new WebSocket("ws://" + host + ":81/");
websocket.onopen = () => console.log("WebSocket connection opened");
websocket.onclose = () => {
console.log("WebSocket connection closed, attempting to reconnect");
setTimeout(initWebSocket, 1000);
};
websocket.onerror = (error) => console.error("WebSocket error:", error);
websocket.onmessage = onWebSocketMessage;
}

function onModeChanged(mode){
fetch(`http://${host}/mode`, {
method: 'POST',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify({mode: mode})
})
.then(response => response.json())
.then(data => console.log('Mode updated:', data))
.catch(error => console.error('Error updating mode:', error));
}

function onStopClicked(){
fetch(`http://${host}/stop`, {
method: 'POST',
headers: {'Content-Type': 'application/json'}
})
.then(response => response.json())
.then(data => console.log('Stop:', data))
.catch(error => console.error('Error stopping:', error));
}

function sendSetpoint(setpoint){
if(websocket && websocket.readyState === WebSocket.OPEN){
websocket.send(JSON.stringify({setpoint: setpoint}));
}
}

function updateDisplay(data){
var setpointPercent = data.setpoint;
var inputPercent = data.input;

if(getSelectedMode() == 2 || getSelectedMode() == 3){
setpointPercent = (data.setpoint * 100) / maxSpeed;
inputPercent = (data.input * 100) / maxSpeed;
}

addDataPoint(currentSetpoint, data.input, data.output);

document.getElementById("bar_setpoint").style.height = `${50 + (setpointPercent * 0.5)}%`;
document.getElementById("bar_setpoint").innerHTML = data.setpoint;
document.getElementById("bar_input").style.height = `${50 + (inputPercent * 0.5)}%`;
document.getElementById("bar_input").innerHTML = data.input;
document.getElementById("bar_output").style.height = `${50 + (data.output * 0.5)}%`;
document.getElementById("bar_output").innerHTML = data.output;

if(showGraph) {
drawGraph();
}
}

function fetchCurrentMode(){
fetch(`http://${host}/mode`)
.then(response => response.json())
.then(data => setModeSelection(data.mode))
.catch(error => console.error('Error fetching mode:', error));
}

function init(){
initWebSocket();
initModeSelector();
setModeCallback(onModeChanged);
setStopCallback(onStopClicked);
initJoystick();

setInterval(() => {
var joystickValue = getJoystickValue();

document.getElementById('joystick-value').textContent = joystickValue;

var scaledValue = joystickValue;
if(getSelectedMode() == 2 || getSelectedMode() == 3){
scaledValue = (joystickValue * maxSpeed) / 100;
}

currentSetpoint = scaledValue;

sendSetpoint(scaledValue);
updateDisplay(controlData);
}, 100);

fetchCurrentMode();
}

init();</script>
</body></html>
)rawliteral";

const char orderPage[] PROGMEM = R"rawliteral(
<!DOCTYPE html><html lang=de ><head><meta charset=UTF-8 ><meta name=viewport content="width=device-width, initial-scale=1.0"><title>Schnapsglas Bestellungen</title><style>body{font-family:Arial,sans-serif;padding:20px;background-color:#f0f0f0;display:flex;flex-direction:column;align-items:center;min-height:100vh;margin:0}.container{display:flex;gap:20px;flex-wrap:wrap;justify-content:center;max-width:1200px;width:100%}.tile{padding:20px;border-radius:10px;min-width:250px;box-shadow:0 4px 6px rgba(0,0,0,0.1)}.tile-red{background-color:#ffebeb;border:3px solid #d62e2e}.tile-green{background-color:#ebffeb;border:3px solid #09a709}.tile-blue{background-color:#ebebff;border:3px solid #1e8fab}.field-group{margin-bottom:15px}label{display:block;margin-bottom:5px;font-weight:bold}input,textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box}textarea{min-height:80px;resize:vertical}h2{margin-top:0;text-align:center}h1{text-align:center;margin-bottom:30px}.deliver-btn{background-color:#4CAF50;color:white;padding:20px 40px;font-size:18px;font-weight:bold;border:none;border-radius:8px;cursor:pointer;margin:30px auto;display:block;box-shadow:0 4px 8px rgba(0,0,0,0.2)}.deliver-btn:hover{background-color:#45a049}</style></head><body><h1>Schnapsglas Bestellungen</h1><div class=container ><div class="tile tile-red"><h2>Glas 1</h2><div class=field-group ><label for=drink1 >Getränketyp:</label><input type=text id=drink1 value=Alkohol ></div><div class=field-group ><label for=person1 >Name der Person:</label><textarea id=person1 placeholder="Name oder Beschreibung eingeben..."></textarea></div></div><div class="tile tile-green"><h2>Glas 2</h2><div class=field-group ><label for=drink2 >Getränketyp:</label><input type=text id=drink2 value=Alkohol ></div><div class=field-group ><label for=person2 >Name der Person:</label><textarea id=person2 placeholder="Name oder Beschreibung eingeben..."></textarea></div></div><div class="tile tile-blue"><h2>Glas 3</h2><div class=field-group ><label for=drink3 >Getränketyp:</label><input type=text id=drink3 value=Alkohol ></div><div class=field-group ><label for=person3 >Name der Person:</label><textarea id=person3 placeholder="Name oder Beschreibung eingeben..."></textarea></div></div></div><button class=deliver-btn onclick="deliverOrder()">Bestellung ausliefern</button><script>function deliverOrder() {
const orders = [];

const name1 = document.getElementById('person1').value.trim();
if (name1) {
orders.push({
name: name1,
drink: document.getElementById('drink1').value,
color: "rot"
});
}

const name2 = document.getElementById('person2').value.trim();
if (name2) {
orders.push({
name: name2,
drink: document.getElementById('drink2').value,
color: "grün"
});
}

const name3 = document.getElementById('person3').value.trim();
if (name3) {
orders.push({
name: name3,
drink: document.getElementById('drink3').value,
color: "blau"
});
}

if (orders.length === 0) {
alert("Bitte geben Sie mindestens einen Namen ein!");
return;
}

console.log("Bestellung:", JSON.stringify(orders, null, 2));
fetch(window.location.origin + '/order', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify(orders)
})
.then(response => response.json())
.then(data => {
console.log('Server response:', data);
})
.catch(error => {
console.error('Error sending order:', error);
});
alert(`Bestellung wurde erstellt!\n${orders.length} Glas/Gläser bestellt.`);
}</script>
</body></html>
)rawliteral";

#endif // FRONTEND_H
